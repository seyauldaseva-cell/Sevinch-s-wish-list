<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–í–∏—à–ª–∏—Å—Ç</title>
  <meta name="description" content="–î–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–µ—Å–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –∏ –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤ —Ü–µ–ª—è—Ö —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–ª—è –∏–º–µ–Ω–∏–Ω–Ω–∏—Ü—ã. –õ—é–±–∞—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –æ–¥–æ–±—Ä—è–µ—Ç—Å—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –¥–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º.." />
  <style>
  /* ===== Barbie theme ===== */
:root{
  --bg1:#fff0f7;
  --bg2:#ffe1f1;
  --pink:#ff4fa3;
  --hot:#ff2d95;
  --soft:#fff3fa;
  --text:#1a0f1a;
  --muted:#6b3b5f;
  --card:rgba(255,255,255,.72);
  --stroke:rgba(255,79,163,.20);
  --shadow: 0 18px 50px rgba(255, 45, 149, .15);
  --shadow2: 0 10px 24px rgba(0,0,0,.06);
}

*{ box-sizing:border-box; }

body{
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  margin:0;
  color:var(--text);
  background:
    radial-gradient(1200px 900px at 10% 0%, rgba(255,79,163,.20), transparent 60%),
    radial-gradient(900px 700px at 95% 12%, rgba(255,45,149,.18), transparent 55%),
    radial-gradient(900px 700px at 50% 110%, rgba(255,165,210,.25), transparent 50%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
}

/* subtle sparkles */
body:before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 12% 18%, rgba(255,255,255,.55) 0 2px, transparent 3px),
    radial-gradient(circle at 82% 22%, rgba(255,255,255,.50) 0 2px, transparent 3px),
    radial-gradient(circle at 64% 68%, rgba(255,255,255,.45) 0 2px, transparent 3px),
    radial-gradient(circle at 22% 72%, rgba(255,255,255,.50) 0 2px, transparent 3px);
  opacity:.55;
  filter: blur(.2px);
}

header{
  max-width:1040px;
  margin:0 auto;
  padding:26px 16px 12px;
}

h1{
  margin:0 0 8px;
  letter-spacing:-.5px;
  font-weight:900;
  font-size: clamp(28px, 4vw, 40px);
  background: linear-gradient(90deg, var(--hot), var(--pink), #ff87c7);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;

  /* Barbie glow ‚ú® */
  text-shadow:
    0 0 6px rgba(255,79,163,.55),
    0 0 14px rgba(255,79,163,.45),
    0 0 26px rgba(255,45,149,.35),
    0 10px 28px rgba(255,45,149,.25);
}

.sub{
  color:var(--muted);
  margin:0 0 16px;
  line-height:1.45;
}

.bar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

input{
  flex:1;
  min-width:240px;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,79,163,.25);
  background: rgba(255,255,255,.80);
  font-size:16px;
  outline:none;
  box-shadow: 0 12px 30px rgba(255,45,149,.10);
}

input:focus{
  border-color: rgba(255,45,149,.55);
  box-shadow: 0 18px 40px rgba(255,45,149,.18);
}

.pill{
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,79,163,.25);
  background: rgba(255,255,255,.72);
  font-size:14px;
  color:var(--muted);
  white-space:nowrap;
  box-shadow: var(--shadow2);
}

main{
  max-width:1040px;
  margin:0 auto;
  padding:0 16px 26px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:14px;
}

.card{
  background: var(--card);
  border:1px solid var(--stroke);
  border-radius:20px;
  padding:14px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transform: translateY(0);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}

.card:hover{
  transform: translateY(-4px);
  box-shadow: 0 26px 70px rgba(255,45,149,.18);
  border-color: rgba(255,45,149,.35);
}

.img{
  width:100%;
  height:200px;
  object-fit:cover;
  border-radius:16px;
  background:#f2f2f2;
  box-shadow: 0 16px 40px rgba(0,0,0,.08);
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}

.title{
  font-weight:900;
  margin:0;
  line-height:1.15;
  letter-spacing:-.2px;
}

.meta{
  color:var(--muted);
  font-size:14px;
  margin:0;
}

.desc{
  font-size:14px;
  color:#3a1630;
  margin:0;
  line-height:1.5;
}

.badge{
  font-size:12px;
  padding:5px 10px;
  border-radius:999px;
  border:1px solid;
  white-space:nowrap;
  margin-top:2px;
  font-weight:700;
}

.free{
  background: rgba(255,255,255,.70);
  border-color: rgba(6,118,71,.25);
  color:#067647;
}

.taken{
  background: rgba(255,255,255,.70);
  border-color: rgba(255,45,149,.35);
  color: var(--hot);
}

/* buttons */
.btns{
  display:flex;
  gap:10px;
  margin-top:auto;
}

a.btn, button.btn{
  flex:1;
  border-radius:14px;
  padding:11px 12px;
  border:1px solid rgba(255,79,163,.25);
  background: rgba(255,255,255,.78);
  cursor:pointer;
  text-decoration:none;
  color:#7a1f53;
  font-size:15px;
  text-align:center;
  font-weight:800;
  box-shadow: var(--shadow2);
  transition: transform .16s ease, box-shadow .16s ease, background .16s ease, border-color .16s ease;
}

a.btn:hover, button.btn:hover{
  transform: translateY(-2px);
  box-shadow: 0 16px 30px rgba(255,45,149,.14);
  border-color: rgba(255,45,149,.40);
}

a.btn.primary{
  background: linear-gradient(135deg, #ff2d95, #ff64b1, #ff98cc);
  border-color: rgba(255,45,149,.50);
  color:#fff;
  position:relative;
  overflow:hidden;
}

/* glossy shine */
a.btn.primary:before{
  content:"";
  position:absolute;
  inset:-40% -20%;
  background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,.45) 45%, transparent 60%);
  transform: translateX(-60%) rotate(10deg);
  transition: transform .5s ease;
}

a.btn.primary:hover:before{
  transform: translateX(40%) rotate(10deg);
}

button.btn{
  background: rgba(255,240,247,.85);
  border-color: rgba(255,79,163,.35);
  color:#b3125e;
}

button.btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  transform:none;
  box-shadow:none;
}

.hint{
  max-width:1040px;
  margin:0 auto;
  padding:0 16px 18px;
  color:var(--muted);
  font-size:13px;
  line-height:1.45;
}

.empty{
  padding:18px;
  border-radius:18px;
  border:1px dashed rgba(255,79,163,.35);
  color:var(--muted);
  background: rgba(255,255,255,.72);
  text-align:center;
  box-shadow: var(--shadow2);
}
  </style>
</head>

<body>
  <header>
    <h1>üéÄ –ú–æ–π –≤–∏—à–ª–∏—Å—Ç</h1>
    <p class="sub">
      –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ —Ü–µ–ª—è—Ö —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ–¥–∞—Ä–∫–∞
      <br> –ë—Ä–æ–Ω—å –∞–Ω–æ–Ω–∏–º–Ω–∞—è  
    </p>

    <div class="bar">
      <input id="q" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–Ω–∏–≥–∞ / —Å–µ—Ä—å–≥–∏ / —Ü–≤–µ—Ç—ã)" />
      <span class="pill" id="count">0 –ø–æ–∑–∏—Ü–∏–π</span>
      <span class="pill" id="takenCount">–ó–∞–Ω—è—Ç–æ: 0</span>
    </div>
  </header>

  <main>
    <div class="grid" id="list"></div>
    <div id="empty" class="empty" style="display:none;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–µ —Å–ª–æ–≤–æ ‚ú®</div>
  </main>

  <div class="hint">
    potom pridumayu
  </div>


<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbylXpFOJh3uKgnDCR7qOm4PSdVcFhugoUne2kg6vJh24bftd0JP758t6qclTEUO_GpU/exec";
  
  let items = [];

  // =========================
  // 2) –†–ï–ù–î–ï–† + –ü–û–ò–°–ö
  // =========================
  const list = document.getElementById('list');
  const q = document.getElementById('q');
  const count = document.getElementById('count');
  const takenCount = document.getElementById('takenCount');
  const empty = document.getElementById('empty');

  function badge(status){
    return status === "taken"
      ? `<span class="badge taken">–ó–∞–Ω—è—Ç–æ</span>`
      : `<span class="badge free">–°–≤–æ–±–æ–¥–Ω–æ</span>`;
  }

  function cardHTML(x){
    const disabled = x.status === "taken" ? "disabled" : "";
    const safeImg = x.img || "https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=1200&q=80";

    return `
      <div class="card" data-title="${(x.title||"").toLowerCase()}">
        <img class="img" src="${safeImg}" alt="${x.title || "–ø–æ–¥–∞—Ä–æ–∫"}" loading="lazy" />
        <div class="row">
          <p class="title">${x.title || ""}</p>
          ${badge(x.status)}
        </div>
        <p class="meta">${x.price || ""}</p>
        <p class="desc">${x.desc || ""}</p>
        <div class="btns">
          <a class="btn primary" href="${x.buy || "#"}" target="_blank" rel="noopener">–ö—É–ø–∏—Ç—å</a>
          <button class="btn" ${disabled} onclick="reserve('${x.id}')">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    `;
  }

  async function loadItems(){
    const res = await fetch(API_URL);
    const data = await res.json();

    items = (data.items || []).map(x => ({
      ...x,
      id: String(x.id).trim(),
      status: String(x.status || "free").trim()
    }));

    render();
  }

  function render(){
    const term = (q.value || "").trim().toLowerCase();
    const filtered = items.filter(x => (x.title||"").toLowerCase().includes(term));

    list.innerHTML = filtered.map(cardHTML).join("");
    count.textContent = `${filtered.length} –ø–æ–∑–∏—Ü–∏–π`;

    const taken = items.filter(x => x.status === "taken").length;
    takenCount.textContent = `–ó–∞–Ω—è—Ç–æ: ${taken}`;

    empty.style.display = filtered.length ? "none" : "block";
  }

  q.addEventListener('input', render);

async function reserve(id){
  try{
    const url = API_URL + "?action=reserve&id=" + encodeURIComponent(String(id)) + "&t=" + Date.now();
    const res = await fetch(url);
    const out = await res.json();

    if(!out.ok){
      alert("–£–ø—Å, —É–∂–µ –∑–∞–Ω—è–ª–∏ ");
      await loadItems();
      return;
    }

    alert("–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ!");
    await loadItems();
  }catch(err){
    alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üôè");
    console.error(err);
  }
}

  loadItems();
</script>

</body>
</html>
